<!DOCTYPE html>
<html>
  <head>
    <% site_name = "漢方アシスト" %>
    <% page_title = content_for?(:title) ? "#{yield(:title)} | #{site_name}" : site_name %>
    <% page_desc  = content_for?(:description) ? yield(:description) : "症状・病名から適応する漢方薬候補をスコアリングして提示する支援ツールです。" %>
    <% page_url   = request.original_url %>
    <% ogp_image  = "#{request.base_url}/ogp.png" %>

    <title><%= page_title %></title>

    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="<%= page_desc %>">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Kampo Assist">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- OGP -->
    <meta property="og:site_name" content="<%= site_name %>">
    <meta property="og:title" content="<%= page_title %>">
    <meta property="og:description" content="<%= page_desc %>">
    <meta property="og:type" content="website">
    <meta property="og:url" content="<%= request.original_url %>">
    <meta property="og:image" content="https://kampo-assist-1.onrender.com/ogp.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="<%= page_title %>">
    <meta name="twitter:description" content="<%= page_desc %>">
    <meta name="twitter:image" content="https://kampo-assist-1.onrender.com/ogp.png">

    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="min-h-screen bg-[#FAFCFB] text-slate-900">
    <header class="border-b bg-white/80 backdrop-blur">
      <div class="mx-auto max-w-6xl px-4 py-4 flex items-center justify-between">
        <%= link_to root_path, class: "font-semibold text-lg text-emerald-950" do %>
          漢方アシスト
        <% end %>

        <nav class="flex items-center gap-6 text-sm">
          <%= link_to "使い方", how_to_path, class: "text-slate-600 hover:text-slate-900" %>

          <% if current_user %>
            <%= link_to "検索履歴", search_sessions_path,
              class: "text-slate-600 hover:text-slate-900" %>

            <%= link_to "お気に入り", favorites_path,
              class: "text-slate-600 hover:text-slate-900" %>

            <%= button_to "ログアウト", user_session_path, method: :delete,
              class: "inline-flex items-center rounded-lg bg-white border border-slate-200 px-3 py-2 font-semibold text-slate-700 hover:bg-slate-50 transition" %>
          <% else %>
            <%= link_to "ログイン", new_user_session_path, class: "text-slate-600 hover:text-slate-900" %>

            <%= link_to "新規登録", new_user_path,
              class: "inline-flex items-center rounded-lg bg-emerald-700 px-3 py-2 font-semibold text-white hover:bg-emerald-800 transition" %>
          <% end %>

          <%= link_to "検索を開始", step1_search_path,
            class: "hidden sm:inline-flex items-center rounded-lg bg-emerald-700 px-4 py-2 font-semibold text-white hover:bg-emerald-800 transition" %>
        </nav>
      </div>
    </header>

    <main class="mx-auto max-w-6xl px-4 py-8">
      <% if flash[:notice] %>
        <div class="mb-4 rounded-xl border border-emerald-100 bg-emerald-50 px-4 py-3 text-emerald-900">
          <%= flash[:notice] %>
        </div>
      <% end %>

      <% if flash[:alert] %>
        <div class="mb-4 rounded-xl border border-rose-100 bg-rose-50 px-4 py-3 text-rose-900">
          <%= flash[:alert] %>
        </div>
      <% end %>

      <%= yield %>
    </main>

    <footer class="border-t bg-white">
      <div class="mx-auto max-w-6xl px-4 py-8 text-sm text-slate-600 flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
        <p>© <%= Time.current.year %> 漢方アシスト</p>
        <nav class="flex gap-4">
          <%= link_to "使い方", how_to_path, class: "hover:text-slate-900" %>
          <%= link_to "利用規約", terms_path, class: "hover:text-slate-900" %>
          <%= link_to "プライバシーポリシー", privacy_path, class: "hover:text-slate-900" %>
        </nav>
      </div>
    </footer>
  </body>
</html>
