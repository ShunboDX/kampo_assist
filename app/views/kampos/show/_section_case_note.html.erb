<section class="space-y-3">
  <h2 class="text-sm font-semibold text-slate-900">
    この検索結果での自分のメモ
  </h2>

  <% if current_user && params[:search_session_id].present? %>

    <% if case_note.present? %>
      <div class="rounded-2xl border border-slate-200 bg-white shadow-sm p-5 sm:p-6">
        <div class="text-sm sm:text-base text-slate-700 leading-relaxed break-words">
          <%= simple_format(h(case_note.body)) %>
        </div>

        <div class="mt-4 flex flex-col sm:flex-row gap-3">
          <%= link_to "メモを編集",
              edit_case_note_path(case_note),
              class: "w-full sm:w-auto inline-flex items-center justify-center rounded-xl
                      border border-slate-300 bg-white
                      px-6 py-3 text-sm font-semibold text-slate-700
                      hover:bg-slate-50 transition" %>
        </div>
      </div>

    <% else %>
      <p class="text-sm text-slate-600">
        この検索結果でのメモはまだありません。
      </p>

      <div class="mt-3">
        <%= link_to "メモを書く",
            new_case_note_path(kampo_id: kampo.id, search_session_id: params[:search_session_id]),
            class: "w-full sm:w-auto inline-flex items-center justify-center rounded-xl
                    bg-emerald-700 px-6 py-3 text-sm font-bold text-white
                    hover:bg-emerald-800 transition" %>
      </div>
    <% end %>

  <% elsif current_user %>
    <p class="text-sm text-slate-600">
      検索結果から詳細を開いた場合に、この漢方へのメモを表示できます。
    </p>

  <% else %>
    <p class="text-sm text-slate-600">
      メモを見るには
      <%= link_to "ログイン",
          new_user_session_path,
          class: "font-semibold text-emerald-700 hover:underline" %>
      が必要です。
    </p>
  <% end %>
</section>
